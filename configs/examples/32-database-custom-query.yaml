# Example: Database Output with queryFile
# Demonstrates using SQL files for complex queries

schemaVersion: "1.1.0"

connector:
  name: database-queryfile-example
  version: "1.0.0"
  description: "Execute SQL queries from external files"

  input:
    type: httpPolling
    endpoint: "https://api.source.com/inventory-updates"
    method: GET
    schedule: "*/5 * * * *"

  filters: []

  output:
    type: database
    connectionStringRef: "${DATABASE_URL}"

    # Load SQL from external file
    # File content uses same {{record.field}} syntax as inline queries
    queryFile: "queries/inventory-upsert.sql"

    onError: log
    timeoutMs: 10000

---
# Example: Update with complex WHERE clause
connector:
  name: database-update-complex
  version: "1.0.0"
  description: "Update records with complex conditions"

  input:
    type: webhook
    path: "/stock-updates"

  filters: []

  output:
    type: database
    connectionStringRef: "${DATABASE_URL}"

    # Inline query for simpler cases
    query: |
      UPDATE products
      SET
        stock_quantity = stock_quantity + {{record.quantity_change}},
        last_updated = CURRENT_TIMESTAMP,
        updated_by = {{record.updated_by}}
      WHERE
        sku = {{record.sku}}
        AND warehouse_id = {{record.warehouse_id}}
        AND status = 'active'

    transaction: true
    onError: fail
