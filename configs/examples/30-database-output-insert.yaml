# Example: Database Output Module - INSERT
# Demonstrates writing records to a database using raw SQL queries

schemaVersion: "1.1.0"

connector:
  name: database-output-insert-example
  version: "1.0.0"
  description: "Sync API data to database"

  input:
    type: httpPolling
    endpoint: "https://api.source.com/products"
    method: GET
    schedule: "*/10 * * * *"

  filters:
    - type: mapping
      mappings:
        - source: "id"
          target: "product_id"
        - source: "name"
          target: "product_name"
        - source: "price"
          target: "unit_price"
        - source: "stock"
          target: "quantity_in_stock"

  output:
    type: database
    connectionStringRef: "${DATABASE_URL}"

    # SQL query with {{record.field}} placeholders
    # Placeholders are replaced with parameterized values for security
    query: |
      INSERT INTO products (product_id, name, price, stock, updated_at)
      VALUES ({{record.product_id}}, {{record.product_name}}, {{record.unit_price}}, {{record.quantity_in_stock}}, NOW())

    # Or use queryFile for complex queries:
    # queryFile: "queries/insert-product.sql"

    # Transaction mode: wrap all inserts in a single transaction
    transaction: true

    # Error handling: fail, skip, log
    onError: skip

    timeoutMs: 30000
